# 2025_hke.27.3a46-8abd_assessment

Hake (Merluccius merluccius) in subareas 4, 6, and 7, and divisions 3.a, 8.a-b, and 8.d, Northern stock (Greater North Sea, Celtic Seas, and the northern Bay of Biscay) - WGBIE (ADGBBI)

The Northern hake (hke.27.3a46-8abd_assessment) assessment model has been structured according to the  [Transparent Assessment Framework (TAF)](https://www.ices.dk/data/assessment-tools/Pages/transparent-assessment-framework.aspx). All input data and software are provided within the *bootstrap/initial* directory. Further software requirements, such as specific R package versions and scripts containing functions, are defined in *SOFTWARE.bib*. In addition, the main directory contains several R and Rmarkdown scripts used to produce all analyses (see *Structure of the code* Section below for details.). 

## How to run

Clone the repository to your local workspace and install the icesTAF package

```R
install.packages("icesTAF")
```

Open R (version 4.2.x) in the cloned `2024_hke.27.3a46-8abd_assessment` directory and run:

```R
library(icesTAF)

# Optional: recommended to clean all produced directories for a completly new build
# clean(dirs = c("bootstrap/data", "bootstrap/software", "data", "model", "output", "report"), force = FALSE) 

taf.bootstrap()
sourceAll()
```


## Structure of the code

Four main scripts are used: data.R, model.R, output.R, and report.R. In most cases, these scripts source other sub-scripts in a defined sequence. The script hierarchy and a brief description of their is as follows:

- **data.R**
  - **data_00_Create_Tables_from_IC.R** - Reads in the InterCatch (*IC*) data from latest year (or previous if updates occur) provided by member countries and generates csv files with the information (Table_1.csv and Table_2.csv). The IC data contains information on catches (landings and discards) and sampling.
  - **data_01_Table1_Table2.R** - Reads the previously created files, processes the data and merges it with historical information. 
  - **data_02_Allocations.R** - Reads in the IC sampling information and makes allocations for unsampled landings and discards.
  - **data_03_Create_SS_Files.R** - Updates the previous Stock Synthesis files incorporating the last year information and moves references to latest year to one year forward.
  - **data_04_Analysis.R** - Analyses the input data and generates summary plots.
  - **data_05_Summary.R** - Summarises input data in several tables.
  - **data_06a_surveys_dat.R** - Compiles survey information from RDBES database.
  - **data_06b_surveys_plot.R** - Generates plots for survey indices.
- **model.R**
  - **model_01_Runs.R** - Runs the assessment, Stock Synthesis (*SS*) with the same data and settings as in previous year (*saly*), just incorporating newest available data (i.e. previous year catches and survey indices). Also runs the SS assessment with alternative configurations. Additionally, runs restros and R0 profile.
  - **model_02_Retros.R**: Analyses the SS assessment retrospective patterns with final data and configuration.
  - **model_03a_Forecast_settings.R** - Sets the settings for the short-term forecast using recruitment generated by SS based on the fitted stock-recruitment relationship in the projection period.
  - **model_03b_Forecast_runs.R** - Runs the short-term forecast for several F-multipliers.
  - **model_03c_Forecast_summary.R** - Summarises short-term forecast with tables and figures for reporting.
  - **model_03d_Forecast_interpolation.R** - Interpolates the short-term forecast results recruitment.
  - **model_04a_ForecastGM_settings.R** - Sets the settings for the short-term forecast using geometric mean of latest recruitments in the projection period.
  - **model_04b_ForecastGM_runs.R** - Runs the short-term forecast for several F-multipliers when GM recruitment.
  - **model_04c_ForecastGM_summary.R** - Summarises short-term forecast (when GM recruitment) with tables and figures for reporting.
  - **model_04d_ForecastGM_interpolation.R** - Interpolates the short-term forecast results when GM recruitment.
- **output.R** 
  - Compiles the SS ouptuts and generates summary tables and figures for reporting.
- **report.R**
    - **report_01_Tables.R** - Produces relevant summary tables for results reporting.
    - **report_02_Graphs.R** - Produces relevant summary figures for results reporting.
    - **report_03_StandardGraphs.R** - Save Stock Assessment Graphs' required data on ICES server.
    - **report_04_AdviceSheet.R** - Produces advice relevant summary figures and tables.
    - **report_05_STF_comparison.R"** - Compares last year advice with current year assessment results.
    - **WGBIE2025_hke.27.3a46-8abd_assessment.Rmd** - Compiles figures and tables for the WG presentation.
    - **WGBIE_2025_09_Hake_north.Rmd** - Produces a first draft of the report section on the stock for the full WGBIE report.
    
Additionally, for generating the information requested by WGMIXIFISH the following scripts are avaiable:
- **report_11_MIXFISH_catch_yr_ctry.R** - Produces and excell file with cathes by country and area (Bay of Biscay or outside).
- **report_12_MIXFISH_SS_to_FLStock.R** - Generates FLStock objects based on SS outputs (also including short-term forecast information).
    
All the generated files when running **data.R**, **model.R**, **output.R** and **report.R** are saved in folders with the same name (**data**, **model**, **output** and **report**, respectively)




